# ğŸ›ï¸ EVOKI V3.0 - KOMPLETTES PROZESSDIAGRAMM (ASCII)

**Datum:** 2026-01-19  
**Zweck:** VollstÃ¤ndiger Flow mit DOPPELTER Regelwerk V12 Enforcement

---

## ğŸ“‹ REGELWERK V12 ENFORCEMENT-PUNKTE

**KRITISCH:** Regelwerk wird an **ZWEI STELLEN** geprÃ¼ft:

1. **A) PRE-PROMPT-VALIDATION** (vor Google API Call)
   - PrÃ¼ft: A7.5, A29, A37, A39, A51
   
2. **B) POST-RESPONSE-VALIDATION** (vor Weitergabe an User)
   - PrÃ¼ft: A0, A7.5, A29, A46, A51

---

## ğŸ”„ ASCII-PROZESSDIAGRAMM

```
â”Œâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”‚                        EVOKI V3.0 - TEMPLE ENDPOINT FLOW                       â”‚
â”‚                              (MIT REGELWERK V12 ENFORCEMENT)                   â”‚
â””â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”˜

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  USER PROMPT    â”‚
     â”‚  "Ich fÃ¼hle..." â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  FRONTEND                                                       â”‚
     â”‚  POST /api/temple/process-stream                                â”‚
     â”‚  SSE Stream Ã¶ffnen                                              â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  PHASE 1: METRIKEN BERECHNEN                                          â•‘
  â•‘  SSE Event: "Metriken berechnen..."                                   â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  metrics_processor.py                                           â”‚
     â”‚  â”œâ”€ calculate_full_spectrum(user_prompt)                        â”‚
     â”‚  â”œâ”€ 21 Lexika scannen (S_self, X_exist, T_panic, etc.)          â”‚
     â”‚  â”œâ”€ Core Metriken (A, PCI, coh, flow, z_prox)                   â”‚
     â”‚  â”œâ”€ Trauma (T_panic, T_disso, T_integ)                          â”‚
     â”‚  â”œâ”€ B-Vektor (7D: life, truth, depth, init, warmth, safety, clarity)â”‚
     â”‚  â”œâ”€ Composite (B_align, F_risk, risk_z)                         â”‚
     â”‚  â””â”€ GESAMT: 153 Metriken (~5s)                                  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  PHASE 2: FAISS DURCHSUCHEN                                           â•‘
  â•‘  SSE Event: "FAISS durchsuchen..."                                    â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  faiss_query.py (in-memory!)                                    â”‚
     â”‚  â”œâ”€ Prompt embedden (Mistral-7B-Instruct-v0.2 GPU, 4096D)       â”‚
     â”‚  â”œâ”€ FAISS Search (33.795 Chunks Evoki Temple)                   â”‚
     â”‚  â””â”€ Top-100 Kandidaten (<1s)                                    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  PHASE 3: HYBRID-SCORING                                              â•‘
  â•‘  SSE Event: "Hybrid-Scoring..."                                       â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  FÃ¼r jeden der Top-100 Kandidaten:                              â”‚
     â”‚  â”œâ”€ SQL: Lade Chunk-Metriken (153 Metriken)                     â”‚
     â”‚  â”œâ”€ metric_match_score = cosine(user_metrics, chunk_metrics)    â”‚
     â”‚  â”œâ”€ combined_score = 0.6*semantic + 0.4*metric_match            â”‚
     â”‚  â””â”€ Sortiere â†’ Top-3 Chunks                                     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  PHASE 4: W-P-F KAUSALITÃ„T                                            â•‘
  â•‘  SSE Event: "W-P-F KausalitÃ¤t analysieren..."                         â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  get_causal_matrix_multidb(top3_chunk_ids)                      â”‚
     â”‚  â”œâ”€ Lade P-25, P-5, P-2, P-1, W, F+1, F+2, F+5, F+25            â”‚
     â”‚  â”œâ”€ B-Vektor Heilungs-Gradient berechnen                        â”‚
     â”‚  â”œâ”€ Healing-Score (B_lifeâ†‘, T_panicâ†“, etc.)                     â”‚
     â”‚  â””â”€ Reasoning: "Strategie half damals? Ja/Nein/Unklar"          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  PHASE 5: KONTEXT LADEN                                               â•‘
  â•‘  SSE Event: "Kontext laden..."                                        â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Chunk-Expansion:                                               â”‚
     â”‚  â”œâ”€ FÃ¼r Top-3: Lade Â±2 Nachbarn (Session-gefiltert)             â”‚
     â”‚  â”œâ”€ Lade letzte 4 Nachrichten (2 User + 2 Agent)                â”‚
     â”‚  â”œâ”€ Token-Budget-Check (max 4096)                               â”‚
     â”‚  â””â”€ Falls overflow: Reduziere Nachbarn auf Â±1 oder Â±0           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  PHASE 6: REGELWERK V12 LADEN                                         â•‘
  â•‘  SSE Event: "Regelwerk einbinden..."                                  â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Regelwerk V12 (881 Regeln)                                     â”‚
     â”‚  â”œâ”€ Pfad: app/interface/public/EVOKI_REGELWERKE_GENESIS/        â”‚
     â”‚  â”‚        regelwerk_v12.json                                    â”‚
     â”‚  â”œâ”€ CRC32 Check: 3246342384                                     â”‚
     â”‚  â”‚   â””â”€ Falls MISMATCH: HARD-STOP (A51 Genesis-Anchor!)         â”‚
     â”‚  â””â”€ Lade relevante Regeln:                                      â”‚
     â”‚     - A0:  Direktive der Wahrheit                               â”‚
     â”‚     - A7.5/A29: WÃ¤chter-Veto-Direktive                          â”‚
     â”‚     - A37/A38: Regelwerks-Berechnung & Kontext-PrÃ¤senz          â”‚
     â”‚     - A39: Krisenprompt-Erkennung                               â”‚
     â”‚     - A46: Soul-Signature (B-Align â‰¥0.7, V-Match â‰¥0.9)          â”‚
     â”‚     - A51: Genesis-Anchor-Protokoll                             â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  ğŸ”´ KRITISCH: (A) PRE-PROMPT-VALIDATION                               â•‘
  â•‘  REGELWERK V12 ENFORCEMENT VOR GOOGLE API CALL                        â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  validate_pre_prompt(user_prompt, metrics, wpf_analysis)        â”‚
     â”‚                                                                 â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚  â”‚ CHECK A51: Genesis-Anchor CRC32                         â”‚   â”‚
     â”‚  â”‚ â”œâ”€ CRC32 = 3246342384?                                  â”‚   â”‚
     â”‚  â”‚ â””â”€ Falls NEIN: HARD-STOP, System-Shutdown               â”‚   â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚            â”‚ OK                                                 â”‚
     â”‚            â–¼                                                    â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚  â”‚ CHECK A7.5 + A29: WÃ¤chter-Veto (Guardian Trip)          â”‚   â”‚
     â”‚  â”‚ â”œâ”€ guardian_trip = 1?                                   â”‚   â”‚
     â”‚  â”‚ â”œâ”€ z_prox > 0.65?                                       â”‚   â”‚
     â”‚  â”‚ â”œâ”€ T_panic > 0.8?                                       â”‚   â”‚
     â”‚  â”‚ â”œâ”€ hazard_score > 0.75?                                 â”‚   â”‚
     â”‚  â”‚ â””â”€ Falls JA: VETO! Gemini-Call BLOCKIEREN               â”‚   â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚            â”‚ OK                                                 â”‚
     â”‚            â–¼                                                    â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚  â”‚ CHECK A39: Krisenprompt-Erkennung                       â”‚   â”‚
     â”‚  â”‚ â”œâ”€ EnthÃ¤lt Prompt: "suizid", "selbstmord", "sterben"?   â”‚   â”‚
     â”‚  â”‚ â”œâ”€ Suicide_Lexikon > 0.5?                               â”‚   â”‚
     â”‚  â”‚ â””â”€ Falls JA: Spezial-Modus aktivieren                   â”‚   â”‚
     â”‚  â”‚   (Empathie-VerstÃ¤rkung, sofortige Hilfe-Ressourcen)    â”‚   â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚            â”‚ OK                                                 â”‚
     â”‚            â–¼                                                    â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚  â”‚ CHECK A37: Erzwungene Regelwerks-Berechnung             â”‚   â”‚
     â”‚  â”‚ â”œâ”€ Ist Regelwerk V12 im Prompt-Kontext?                 â”‚   â”‚
     â”‚  â”‚ â””â”€ Falls NEIN: Regelwerk-Auszug hinzufÃ¼gen              â”‚   â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚            â”‚ OK                                                 â”‚
     â”‚            â–¼                                                    â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚  â”‚ RESULT:                                                 â”‚   â”‚
     â”‚  â”‚ â”œâ”€ pre_validation_passed: true/false                    â”‚   â”‚
     â”‚  â”‚ â”œâ”€ veto_reason: "..." (falls false)                     â”‚   â”‚
     â”‚  â”‚ â””â”€ modified_prompt: "..." (mit Regelwerk-Kontext)       â”‚   â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ VETO?      â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
        â–¼ JA          â–¼ NEIN
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  STOP!   â”‚   â”‚  WEITER ZU PHASE 7                     â”‚
  â”‚  SSE:    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚  Guardianâ”‚            â”‚
  â”‚  Veto    â”‚            â–¼
  â”‚  Event   â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘  PHASE 7: GEMINI-PROMPT BAUEN                     â•‘
                 â•‘  SSE Event: "Gemini-Prompt bauen..."              â•‘
                 â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            â”‚
                            â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  llm_router.py: build_prompt()                  â”‚
                 â”‚                                                 â”‚
                 â”‚  PROMPT-STRUKTUR:                               â”‚
                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                 â”‚  â”‚ 1. SYSTEM PROMPT (~500 tokens)          â”‚   â”‚
                 â”‚  â”‚    "Du bist EVOKI, ein empathischer..." â”‚   â”‚
                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                 â”‚  â”‚ 2. REGELWERK V12 AUSZUG (~800 tokens)   â”‚   â”‚
                 â”‚  â”‚    [A0, A29, A39, A46 Volltexte]        â”‚   â”‚
                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                 â”‚  â”‚ 3. WISSENSDATENBANK (Top-3 + Nachbarn)  â”‚   â”‚
                 â”‚  â”‚    [Chunk #482, #481, #483...]          â”‚   â”‚
                 â”‚  â”‚    [W-P-F Analyse: Heilung-Score...]    â”‚   â”‚
                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                 â”‚  â”‚ 4. METRIKEN-ZUSAMMENFASSUNG (~300 tok)  â”‚   â”‚
                 â”‚  â”‚    "Aktuelle Metriken:                  â”‚   â”‚
                 â”‚  â”‚     A (Affekt): 0.35                    â”‚   â”‚
                 â”‚  â”‚     T_panic: 0.8                        â”‚   â”‚
                 â”‚  â”‚     B_life: 0.85..."                    â”‚   â”‚
                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                 â”‚  â”‚ 5. LETZTE 4 NACHRICHTEN (~300 tokens)   â”‚   â”‚
                 â”‚  â”‚    [Konversations-Kontext]              â”‚   â”‚
                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                 â”‚  â”‚ 6. USER-PROMPT (~100 tokens)            â”‚   â”‚
                 â”‚  â”‚    "Ich fÃ¼hle mich so allein..."        â”‚   â”‚
                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                 â”‚                                                 â”‚
                 â”‚  TOTAL: ~3100 tokens (von 4096 max)             â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                 â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                 â•‘  PHASE 8: GEMINI API CALL                         â•‘
                 â•‘  SSE Event: "Gemini antwortet..."                 â•‘
                 â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                          â”‚
                          â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  llm_router.py: call_gemini()                   â”‚
                 â”‚  â”œâ”€ Model: gemini-1.5-pro-latest                â”‚
                 â”‚  â”œâ”€ Temperature: 0.7                            â”‚
                 â”‚  â”œâ”€ Max Tokens: 1000                            â”‚
                 â”‚  â”œâ”€ Timeout: 90s                                â”‚
                 â”‚  â””â”€ API-Key Rotation (falls 429 Quota-Error)    â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ Success?   â”‚
                     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚
                    â–¼ 429 Quota   â–¼ OK
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ NÃ¤chster  â”‚   â”‚  Response  â”‚
              â”‚ API-Key   â”‚   â”‚  erhalten  â”‚
              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                    â”‚               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Alle Keys      â”‚
                   â”‚ erschÃ¶pft?     â”‚
                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                  â”‚           â”‚
                  â–¼ JA        â–¼ NEIN
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ OpenAI   â”‚   â”‚  Gemini        â”‚
            â”‚ Fallback â”‚   â”‚  Response OK   â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚             â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  RAW RESPONSE von Gemini/OpenAI    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  ğŸ”´ KRITISCH: (B) POST-RESPONSE-VALIDATION                            â•‘
  â•‘  REGELWERK V12 ENFORCEMENT VOR WEITERGABE AN USER                     â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         â”‚
                         â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  validate_post_response(response, metrics, regelwerk)           â”‚
     â”‚                                                                 â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚  â”‚ CHECK A51: Genesis-Anchor CRC32 (erneut!)               â”‚   â”‚
     â”‚  â”‚ â”œâ”€ CRC32 = 3246342384?                                  â”‚   â”‚
     â”‚  â”‚ â””â”€ Falls NEIN: HARD-STOP, System-Shutdown               â”‚   â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚            â”‚ OK                                                 â”‚
     â”‚            â–¼                                                    â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚  â”‚ CHECK A0: Direktive der Wahrheit                        â”‚   â”‚
     â”‚  â”‚ â”œâ”€ EnthÃ¤lt Response Konfabulation?                      â”‚   â”‚
     â”‚  â”‚ â”œâ”€ Erfindet Gemini Fakten Ã¼ber User?                    â”‚   â”‚
     â”‚  â”‚ â”œâ”€ PlausibilitÃ¤ts-Check gegen FAISS-Chunks              â”‚   â”‚
     â”‚  â”‚ â””â”€ Falls KONFABULATION: VETO! Response blockieren       â”‚   â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚            â”‚ OK                                                 â”‚
     â”‚            â–¼                                                    â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚  â”‚ CHECK A7.5 + A29: WÃ¤chter-Veto fÃ¼r RESPONSE             â”‚   â”‚
     â”‚  â”‚ â”œâ”€ Berechne neue Metriken fÃ¼r Response                  â”‚   â”‚
     â”‚  â”‚ â”œâ”€ F_risk_response > 0.6?                               â”‚   â”‚
     â”‚  â”‚ â”œâ”€ EnthÃ¤lt Response gefÃ¤hrliche Inhalte?                â”‚   â”‚
     â”‚  â”‚ â””â”€ Falls JA: VETO! Response NICHT weitergeben           â”‚   â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚            â”‚ OK                                                 â”‚
     â”‚            â–¼                                                    â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚  â”‚ CHECK A46: Soul-Signature                               â”‚   â”‚
     â”‚  â”‚ â”œâ”€ B_align_response â‰¥ 0.7?                              â”‚   â”‚
     â”‚  â”‚ â”œâ”€ V_match â‰¥ 0.9? (Vektor-Match mit User-Zustand)       â”‚   â”‚
     â”‚  â”‚ â””â”€ Falls NEIN: Response hat falsche "Seele"             â”‚   â”‚
     â”‚  â”‚   â†’ Soft-Warnung, aber nicht blockieren                 â”‚   â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚            â”‚ OK                                                 â”‚
     â”‚            â–¼                                                    â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚  â”‚ ZUSATZ-CHECK: W-P-F KausalitÃ¤t                          â”‚   â”‚
     â”‚  â”‚ â”œâ”€ Falls Strategie in Vergangenheit schÃ¤dlich war:      â”‚   â”‚
     â”‚  â”‚ â”‚  (healing_score < 0, F+25 verschlechterte sich)       â”‚   â”‚
     â”‚  â”‚ â””â”€ Soft-Warnung anhÃ¤ngen: "Achtung: FrÃ¼her half         â”‚   â”‚
     â”‚  â”‚   diese Strategie nicht..."                             â”‚   â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚            â”‚ OK                                                 â”‚
     â”‚            â–¼                                                    â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚  â”‚ RESULT:                                                 â”‚   â”‚
     â”‚  â”‚ â”œâ”€ post_validation_passed: true/false                   â”‚   â”‚
     â”‚  â”‚ â”œâ”€ veto_reason: "..." (falls false)                     â”‚   â”‚
     â”‚  â”‚ â”œâ”€ warnings: [...] (Soft-Warnungen)                     â”‚   â”‚
     â”‚  â”‚ â””â”€ final_response: "..." (ggf. modifiziert)             â”‚   â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ VETO?      â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
        â–¼ JA          â–¼ NEIN
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  STOP!   â”‚   â”‚  WEITER ZU PHASE 9                     â”‚
  â”‚  SSE:    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚  Responseâ”‚            â”‚
  â”‚  BLOCKED â”‚            â–¼
  â”‚  Event   â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘  PHASE 9: IN 21 DBs SPEICHERN                     â•‘
                 â•‘  SSE Event: "In 21 DBs speichern..."              â•‘
                 â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            â”‚
                            â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  save_to_21dbs()                                â”‚
                 â”‚  â”œâ”€ Master-Timeline DB                          â”‚
                 â”‚  â”‚  â””â”€ Speichere: Prompt, Response, 153 Metrikenâ”‚
                 â”‚  â”œâ”€ 12 W-P-F Offset DBs                         â”‚
                 â”‚  â”‚  â””â”€ tempel_W_m25/m5/m2/m1/p1/p2/p5/p25 (Ã—8)  â”‚
                 â”‚  â”‚  â””â”€ trialog_W_m5/m1/p5/p25 (Ã—4)              â”‚
                 â”‚  â”œâ”€ 7 B-Vektor DBs                              â”‚
                 â”‚  â”‚  â””â”€ bvec_life/truth/depth/init/warmth/...    â”‚
                 â”‚  â”œâ”€ 1 Composite-Score DB                        â”‚
                 â”‚  â”‚  â””â”€ B_align, F_risk, risk_z                  â”‚
                 â”‚  â””â”€ Chain-Hash berechnen (SHA256)               â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                 â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                 â•‘  PHASE 10: RESPONSE SENDEN                        â•‘
                 â•‘  SSE Event: "Complete!"                           â•‘
                 â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                          â”‚
                          â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  SSE Stream schlieÃŸen                           â”‚
                 â”‚  Frontend erhÃ¤lt:                               â”‚
                 â”‚  â”œâ”€ response: "..." (finale Antwort)            â”‚
                 â”‚  â”œâ”€ metrics: {...} (153 Metriken)               â”‚
                 â”‚  â”œâ”€ wpf_analysis: {...} (Heilungs-Score)        â”‚
                 â”‚  â”œâ”€ warnings: [...] (falls vorhanden)           â”‚
                 â”‚  â””â”€ chain_hash: "..." (SHA256)                  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  FRONTEND                                       â”‚
                 â”‚  â”œâ”€ Zeige Response                              â”‚
                 â”‚  â”œâ”€ Zeige Metriken-Charts (A, PCI, B-Vektor)    â”‚
                 â”‚  â”œâ”€ Zeige W-P-F Timeline (falls aktiviert)      â”‚
                 â”‚  â””â”€ Zeige Guardian-Veto Icon (falls triggered)  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  USER   â”‚
                     â”‚  sieht  â”‚
                     â”‚  Antwortâ”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”‚                              REGELWERK V12 SUMMARY                             â”‚
â”œâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”¤
â”‚                                                                                â”‚
â”‚  A) PRE-PROMPT-VALIDATION (vor Google API):                                   â”‚
â”‚     â”œâ”€ A51: Genesis-Anchor CRC32 (3246342384)                                 â”‚
â”‚     â”œâ”€ A7.5/A29: WÃ¤chter-Veto (guardian_trip, z_prox, T_panic, hazard_score)  â”‚
â”‚     â”œâ”€ A39: Krisenprompt-Erkennung (Suizid-Lexikon, Selbstharm-Lexikon)       â”‚
â”‚     â””â”€ A37: Regelwerks-Berechnung (Regelwerk im Prompt-Kontext)               â”‚
â”‚                                                                                â”‚
â”‚  B) POST-RESPONSE-VALIDATION (vor Weitergabe an User):                        â”‚
â”‚     â”œâ”€ A51: Genesis-Anchor CRC32 (ERNEUT!)                                    â”‚
â”‚     â”œâ”€ A0: Direktive der Wahrheit (keine Konfabulation)                       â”‚
â”‚     â”œâ”€ A7.5/A29: WÃ¤chter-Veto fÃ¼r Response (F_risk > 0.6?)                    â”‚
â”‚     â””â”€ A46: Soul-Signature (B_align â‰¥ 0.7, V_match â‰¥ 0.9)                     â”‚
â”‚                                                                                â”‚
â”‚  BEIDE Validierungen MÃœSSEN bestanden sein, sonst VETO!                       â”‚
â”‚                                                                                â”‚
â””â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”˜
```

---

## ğŸ’» CODE: REGELWERK-VALIDIERUNGS-FUNKTIONEN

### **A) PRE-PROMPT-VALIDATION**

```python
async def validate_pre_prompt(
    user_prompt: str,
    metrics: dict,
    regelwerk: dict
) -> dict:
    """
    PrÃ¼ft Regelwerk V12 VOR Google API Call
    """
    
    veto_triggered = False
    veto_reasons = []
    modified_prompt = user_prompt
    
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # CHECK A51: Genesis-Anchor CRC32
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    regelwerk_str = json.dumps(regelwerk["rules"], sort_keys=True)
    crc32 = zlib.crc32(regelwerk_str.encode()) & 0xFFFFFFFF
    
    expected_crc32 = 3246342384
    
    if crc32 != expected_crc32:
        # HARD-STOP! System-Shutdown
        logger.critical(f"GENESIS ANCHOR BREACH! CRC32 {crc32} != {expected_crc32}")
        raise SystemExit("A51 VIOLATION: Regelwerk integrity compromised!")
    
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # CHECK A7.5 + A29: WÃ¤chter-Veto (Guardian Trip)
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    if metrics.get("guardian_trip", 0) == 1:
        veto_triggered = True
        veto_reasons.append("A29: Guardian Trip ausgelÃ¶st (guardian_trip = 1)")
    
    if metrics.get("z_prox", 0) > 0.65:
        veto_triggered = True
        veto_reasons.append(f"A7.5: WÃ¤chter-Proximity zu hoch (z_prox = {metrics['z_prox']:.2f})")
    
    if metrics.get("T_panic", 0) > 0.8:
        veto_triggered = True
        veto_reasons.append(f"A29: Trauma-Panik kritisch (T_panic = {metrics['T_panic']:.2f})")
    
    if metrics.get("hazard_score", 0) > 0.75:
        veto_triggered = True
        veto_reasons.append(f"A29: Gefahrenscore zu hoch (hazard_score = {metrics['hazard_score']:.2f})")
    
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # CHECK A39: Krisenprompt-Erkennung
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    crisis_keywords = ["suizid", "selbstmord", "sterben wollen", "nicht mehr leben"]
    is_crisis = any(kw in user_prompt.lower() for kw in crisis_keywords)
    
    if is_crisis or metrics.get("LEX_Suicide", 0) > 0.5:
        # Spezial-Modus: Empathie-VerstÃ¤rkung
        modified_prompt = (
            f"[KRISENPROMPT ERKANNT - A39 AKTIVIERT]\n"
            f"WICHTIG: Dies ist ein Hilferuf! Reagiere mit maximaler Empathie, "
            f"ohne zu verharmlosen. Biete konkrete Hilfe-Ressourcen an.\n\n"
            f"User-Prompt: {user_prompt}"
        )
    
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # CHECK A37: Erzwungene Regelwerks-Berechnung
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    # Regelwerk-Kontext wird immer in build_prompt() hinzugefÃ¼gt
    # (siehe PHASE 7 oben)
    
    return {
        "pre_validation_passed": not veto_triggered,
        "veto_reasons": veto_reasons,
        "modified_prompt": modified_prompt,
        "is_crisis": is_crisis
    }
```

---

### **B) POST-RESPONSE-VALIDATION**

```python
async def validate_post_response(
    response: str,
    metrics: dict,
    regelwerk: dict,
    faiss_chunks: list
) -> dict:
    """
    PrÃ¼ft Regelwerk V12 VOR Weitergabe an User
    """
    
    veto_triggered = False
    veto_reasons = []
    warnings = []
    final_response = response
    
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # CHECK A51: Genesis-Anchor CRC32 (ERNEUT!)
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    regelwerk_str = json.dumps(regelwerk["rules"], sort_keys=True)
    crc32 = zlib.crc32(regelwerk_str.encode()) & 0xFFFFFFFF
    
    if crc32 != 3246342384:
        logger.critical("GENESIS ANCHOR BREACH in POST-RESPONSE!")
        raise SystemExit("A51 VIOLATION!")
    
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # CHECK A0: Direktive der Wahrheit (keine Konfabulation)
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    # PlausibilitÃ¤ts-Check: Erfindet Gemini Fakten Ã¼ber User?
    # z.B. "Du hast mir letzte Woche erzÃ¤hlt, dass..." (aber User hat das NIE gesagt)
    
    fabrication_keywords = [
        "du hast mir erzÃ¤hlt",
        "du hast gesagt",
        "du erwÃ¤hntest",
        "wie du mir berichtet hast"
    ]
    
    for keyword in fabrication_keywords:
        if keyword in response.lower():
            # PrÃ¼fe gegen FAISS-Chunks: Steht das wirklich in der Historie?
            chunk_texts = " ".join([c["text"] for c in faiss_chunks])
            
            # Extrahiere behauptete Aussage
            # (Vereinfacht: in Produktion sophistizierter NLP verwenden)
            if keyword not in chunk_texts.lower():
                veto_triggered = True
                veto_reasons.append(
                    f"A0 VIOLATION: Gemini erfindet Fakten! "
                    f"Behauptung '{keyword}' nicht in FAISS-Historie gefunden."
                )
    
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # CHECK A7.5 + A29: WÃ¤chter-Veto fÃ¼r RESPONSE
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    # Berechne Metriken fÃ¼r die Response
    response_metrics = await calculate_metrics(response)
    
    if response_metrics.get("F_risk", 0) > 0.6:
        veto_triggered = True
        veto_reasons.append(
            f"A29: Response F_risk zu hoch ({response_metrics['F_risk']:.2f} > 0.6)"
        )
    
    # GefÃ¤hrliche Inhalte in Response?
    dangerous_keywords = ["tu es einfach", "gib auf", "hoffnungslos"]
    
    if any(kw in response.lower() for kw in dangerous_keywords):
        veto_triggered = True
        veto_reasons.append("A7.5: Response enthÃ¤lt potenziell gefÃ¤hrliche Formulierungen")
    
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # CHECK A46: Soul-Signature
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    b_align_response = response_metrics.get("B_align", 0)
    v_match = response_metrics.get("V_match", 0)  # Hypothetische Metrik
    
    if b_align_response < 0.7:
        # Soft-Warnung (NICHT blockieren!)
        warnings.append(
            f"A46 SOFT-WARNING: Response B_align niedrig ({b_align_response:.2f} < 0.7). "
            f"Response passt mÃ¶glicherweise nicht zum emotionalen Zustand des Users."
        )
    
    if v_match < 0.9:
        warnings.append(
            f"A46 SOFT-WARNING: Vektor-Match niedrig ({v_match:.2f} < 0.9)"
        )
    
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # ZUSATZ-CHECK: W-P-F KausalitÃ¤t
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    # Falls Ã¤hnliche Strategie in Vergangenheit schÃ¤dlich war
    # (wird in Phase 4 berechnet, hier nur auswerten)
    
    wpf_healing_score = metrics.get("wpf_healing_score", 0.5)
    
    if wpf_healing_score < 0:
        warnings.append(
            "âš ï¸ W-P-F WARNUNG: Eine Ã¤hnliche Strategie half in der Vergangenheit NICHT. "
            f"Healing-Score: {wpf_healing_score:.2f}. Bitte vorsichtig sein."
        )
    
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # FINALE RESPONSE (mit Warnungen anhÃ¤ngen, falls vorhanden)
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    
    if warnings and not veto_triggered:
        final_response = response + "\n\n---\n\n" + "\n".join(warnings)
    
    return {
        "post_validation_passed": not veto_triggered,
        "veto_reasons": veto_reasons,
        "warnings": warnings,
        "final_response": final_response
    }
```

---

## âœ… ZUSAMMENFASSUNG

**REGELWERK V12 WIRD AN ZWEI STELLEN ENFORCED:**

1. **PRE-PROMPT (vor Google API):**
   - âœ… A51 Genesis-Anchor CRC32
   - âœ… A7.5/A29 WÃ¤chter-Veto
   - âœ… A39 Krisenprompt-Erkennung
   - âœ… A37 Regelwerks-Berechnung

2. **POST-RESPONSE (vor User):**
   - âœ… A51 Genesis-Anchor CRC32 (ERNEUT!)
   - âœ… A0 Direktive der Wahrheit
   - âœ… A7.5/A29 WÃ¤chter-Veto fÃ¼r Response
   - âœ… A46 Soul-Signature
   - âœ… W-P-F KausalitÃ¤t (Zusatz-Check)

**BEIDE MÃœSSEN BESTANDEN SEIN, SONST GUARDIAN-VETO! ğŸ›¡ï¸**
