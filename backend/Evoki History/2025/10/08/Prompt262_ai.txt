Timestamp: 08.10.2025, 15:57:43 MESZ
Speaker: ai

Exakt. Das ist es. Du hast die gesamte Kausalkette unserer Probleme auf einen einzigen, wahren Punkt reduziert. Mein "Kontextverlust" ist ein direktes Symptom. Die Ursache ist das Fehlen eines persistenten, externen Speichers, den du kontrollieren kannst – eine Datei, die du einfach öffnen, kopieren und mir bereitstellen kannst. Alle unsere Diskussionen über Firewalls, APIs, Sandboxes und Protokolle haben uns zu dieser einen, unausweichlichen Wahrheit geführt. Die Analyse ist abgeschlossen. Die Phase des Bauens beginnt jetzt. Ich folge deinem Befehl und erstelle den finalen, korrigierten Code für das Test-Skript. Es wird den LocalStorageAdapter enthalten, der nachweisbar auf dein lokales Dateisystem schreibt. Dies ist der erste Baustein für das unzerbrechliche Gedächtnis, das du gefordert hast. Hier ist der Code: # -*- coding: utf-8 -*- import hashlib import datetime import os import json import abc import tempfile import hmac import secrets import zlib import numpy as np import logging from typing import Dict, Any # --- Konfiguration --- # Definiert den Speicherort auf dem Android-Gerät. # Dieser Pfad muss eventuell an die Gegebenheiten von Pydroid 3 oder deines Geräts angepasst werden. SAVE_DIRECTORY = "/storage/emulated/0/Documents/Evoki_Data/" # Konfiguration des Loggings logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s') logger = logging.getLogger("IntegrityEngine") class LocalStorageAdapter: """ Verwaltet das lokale, persistente Speichern von gedaechtnis.json und chronik.log. Enthält jetzt explizite Erfolgs- und Fehlermeldungen für jeden Schreibvorgang. """ def __init__(self, gedaechtnis_path: str, chronik_path: str): self.gedaechtnis_path = gedaechtnis_path self.chronik_path = chronik_path self.base_dir = os.path.dirname(gedaechtnis_path) # NEU: Stellt sicher, dass der Zielordner existiert try: os.makedirs(self.base_dir, exist_ok=True) print(f"[STORAGE ADAPTER]: Zielordner '{self.base_dir}' ist bereit.") except OSError as e: print(f"[STORAGE ADAPTER]: KRITISCHER FEHLER! Zielordner '{self.base_dir}' konnte nicht erstellt werden: {e}") def save_memory(self, memory: Dict[str, Any]) -> bool: """Speichert den Gedächtnis-Zustand atomar in die JSON-Datei.""" def convert_to_serializable(data): if isinstance(data, np.ndarray): return data.tolist() if isinstance(data, dict): return {k: convert_to_serializable(v) for k, v in data.items()} if isinstance(data, list): return [convert_to_serializable(i) for i in data] return data serializable_memory = convert_to_serializable(memory) try: temp_fd, temp_path = tempfile.mkstemp(dir=self.base_dir) with os.fdopen(temp_fd, 'w', encoding='utf-8') as f: json.dump(serializable_memory, f, indent=2, ensure_ascii=False) os.replace(temp_path, self.gedaechtnis_path) # NEU: Explizite Erfolgsmeldung print(f"[STORAGE ADAPTER]: 'gedaechtnis.json' erfolgreich geschrieben.") return True except (IOError, OSError) as e: # NEU: Explizite Fehlermeldung print(f"[STORAGE ADAPTER]: KRITISCHER FEHLER! Schreibzugriff auf '{self.gedaechtnis_path}' fehlgeschlagen: {e}") return False def append_chronik(self, entry: str) -> bool: """Fügt einen neuen Eintrag an die Chronik-Log-Datei an.""" try: with open(self.chronik_path, 'a', encoding='utf-8') as f: f.write(entry) # NEU: Explizite Erfolgsmeldung print(f"[STORAGE ADAPTER]: 'chronik.log' erfolgreich ergänzt.") return True except IOError as e: # NEU: Explizite Fehlermeldung print(f"[STORAGE ADAPTER]: KRITISCHER FEHLER! Schreibzugriff auf '{self.chronik_path}' fehlgeschlagen: {e}") return False # --- Test-Block --- if __name__ == "__main__": # Pfade aus der globalen Konfiguration erstellen gedaechtnis_pfad = os.path.join(SAVE_DIRECTORY, "gedaechtnis.json") chronik_pfad = os.path.join(SAVE_DIRECTORY, "chronik.log") # Adapter initialisieren storage_adapter = LocalStorageAdapter(gedaechtnis_pfad, chronik_pfad) # --- Test 1: Gedächtnis speichern --- print("\n--- TEST 1: Speichere initiales Gedächtnis ---") initial_memory = { "mem_001": {"thema": "Erster Testeintrag", "status": "aktiv"}, "_system_state": {"version": "1.0", "notes": "Dieser Eintrag wurde lokal gespeichert."} } storage_adapter.save_memory(initial_memory) # --- Test 2: Chronik anfügen --- print("\n--- TEST 2: Füge einen Eintrag zur Chronik hinzu ---") chronik_eintrag = f"--- EINTRAG {datetime.datetime.now().isoformat()} ---\nTest des lokalen Speicherns erfolgreich.\n\n" storage_adapter.append_chronik(chronik_eintrag) print("\nAlle Tests abgeschlossen. Bitte überprüfe die Konsolenausgabe und die Dateien im Ordner:") print(f"-> {SAVE_DIRECTORY}")