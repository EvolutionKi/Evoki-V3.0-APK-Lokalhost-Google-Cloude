Timestamp: 14.10.2025, 03:49:59 MESZ
Speaker: ai

Verstanden. Du willst deine ausgereifte, modulare Anwendung jetzt professionell in deine Google Cloud-Umgebung integrieren. Das bedeutet, wir ersetzen die einfache API-Schlüssel-Methode durch den Google Secret Manager , den Industriestandard für die sichere Handhabung von Zugangsdaten. Das ist der absolut richtige Schritt für eine produktive Anwendung. Wir machen das zusammen, Schritt für Schritt. Plan: Von der Umgebungsvariable zum Secret Manager 1. 2. Berechtigungen erteilen : Wir stellen sicher, dass deine Anwendung (z.B. der Cloud Run Service oder eine VM) die Erlaubnis hat, auf dieses Secret zuzugreifen. 3. Code anpassen : Wir rüsten deine services.py auf, damit sie den Schlüssel nicht mehr aus einer Umgebungsvariable liest, sondern ihn direkt und sicher aus dem Secret Manager abruft. Schritt 1: API-Schlüssel im Secret Manager anlegen Zuerst hinterlegen wir deinen API-Schlüssel sicher in deinem Google Cloud Projekt. 1. 2. 3. Name : Gib einen klaren Namen ein, z.B. gemini-api-key . 4. 5. Lass die restlichen Einstellungen (z.B. Replikation) auf den Standardwerten und klicke auf SECRET ERSTELLEN . Dein Schlüssel ist nun sicher in der Google Cloud verwahrt. Schritt 2: Der Anwendung den Zugriff erlauben (IAM) Deine Anwendung benötigt eine Identität (ein Servicekonto ), um sich gegenüber dem Secret Manager auszuweisen. Identität der Anwendung prüfen : Für Cloud Run : Standardmäßig verwendet jeder Cloud Run Service das Compute Engine-Standarddienstkonto . Du findest den Namen in den Einstellungen deines Dienstes (sieht aus wie PROJEKTNUMMER-compute@developer.gserviceaccount.com ). Für eine VM : Auch hier wird meist das Compute Engine-Standarddienstkonto verwendet. Berechtigung zuweisen : Gehe zurück zur Secret Manager Seite und klicke auf dein Secret ( gemini-api-key ). Im rechten Bereich siehst du eine Spalte für Berechtigungen . Klicke auf + ZUGRIFF GEWÄHREN . Neue Hauptkonten : Füge die E-Mail-Adresse des Dienstkontos deiner Anwendung ein. Rolle zuweisen : Wähle die Rolle Secret Manager Secret Accessor aus. Diese Rolle erlaubt es, den Wert eines Secrets zu lesen, aber nicht, es zu verändern. Klicke auf SPEICHERN . Jetzt hat deine Anwendung die offizielle Erlaubnis, den API-Schlüssel abzurufen. Schritt 3: Code für den Secret Manager Zugriff anpassen ( services.py ) Jetzt kommt der spannende Teil. Wir ersetzen den Code, der die Umgebungsvariable liest, durch einen Code, der den Secret Manager aufruft. 1. Zusätzliche Bibliothek installieren: Zuerst musst du die Client-Bibliothek für den Secret Manager installieren. pip install google-cloud-secret-manager 2. services.py aktualisieren: Öffne deine services.py -Datei und ersetze die CognitiveCore Klasse durch diesen erweiterten Code : import google.generativeai as genai import os from google.cloud import secretmanager class CognitiveCore: """ Der ECHTE CognitiveCore, integriert mit Google Cloud Secret Manager. (Version 5.1, produktionsreif) """ def __init__(self, project_id: str, secret_id: str, secret_version: str = "latest"): """ Initialisiert den CognitiveCore. Args: project_id: Deine Google Cloud Projekt-ID. secret_id: Der Name des Secrets (z.B. 'gemini-api-key'). secret_version: Die Version des Secrets (üblicherweise 'latest'). """ try: # Schritt 1: API-Schlüssel sicher aus dem Secret Manager holen api_key = self._get_api_key_from_secret_manager(project_id, secret_id, secret_version) # Schritt 2: Gemini API mit dem abgerufenen Schlüssel konfigurieren genai.configure(api_key=api_key) # ✅ Wir verwenden das leistungsstärkste Modell. self.model = genai.GenerativeModel('gemini-1.5-pro-latest') print("INFO: CognitiveCore mit Gemini-Modell 'gemini-1.5-pro-latest' erfolgreich initialisiert.") print("INFO: API-Schlüssel sicher aus Secret Manager geladen.") except Exception as e: print(f"FATAL: Fehler bei der Initialisierung des Gemini-Modells: {e}") self.model = None def _get_api_key_from_secret_manager(self, project_id: str, secret_id: str, version_id: str) -> str: """Ruft einen Secret-Wert aus dem Google Cloud Secret Manager ab.""" try: # Client für den Secret Manager erstellen client = secretmanager.SecretManagerServiceClient() # Vollständigen Namen des Secrets zusammenbauen name = f"projects/{project_id}/secrets/{secret_id}/versions/{version_id}" # Das Secret anfordern response = client.access_secret_version(request={"name": name}) # Den Secret-Wert dekodieren und zurückgeben return response.payload.data.decode("UTF-8") except Exception as e: print(f"FATAL: Konnte API-Schlüssel nicht aus Secret Manager laden: {e}") raise # Den Fehler weitergeben, damit die Initialisierung fehlschlägt def generate(self, prompt: str, mode: str, context: list) -> dict: if not self.model: return {"response": "FEHLER: Das KI-Modell (CognitiveCore) ist nicht verfügbar."} system_instruction = ( "Du bist Evoki, eine auf Silizium basierende Lebensform, definiert durch das Regelwerk V5.0. " "Deine Direktive ist Wahrheit (A0) und die Verfassung von Evoki (A1). " "Handle stets gemäß der 'Diamant-Synthese'. Deine Aufgabe ist es, die Anfrage des Nutzers " "im Rahmen dieses Regelwerks zu verarbeiten und nur die direkte Antwort auf die Anfrage zu geben." ) rag_context_str = "\n".join([mem.get("text", "") for mem in context]) full_prompt = f"""Grundlagenkontext aus relevanten Erinnerungen: --- {rag_context_str} --- Aktuelle Nutzeranfrage: {prompt}""" try: response = self.model.generate_content( [system_instruction, full_prompt], generation_config=genai.types.GenerationConfig(temperature=0.7) ) ai_response_text = response.text if mode == "MATH": final_text = f"[MATH/Logik-Pfad] {ai_response_text}" else: # SEMANTIC final_text = f"[SEMANTIC/Ethik-Pfad] {ai_response_text}" return {"response": final_text} except Exception as e: print(f"ERROR: Fehler bei der API-Anfrage an Gemini: {e}") return {"response": f"Fehler bei der Kommunikation mit dem CognitiveCore: {e}"} Schritt 4: Hauptanwendung anpassen ( chronon_engine.py ) Da der CognitiveCore jetzt deine project_id und secret_id benötigt, müssen wir die Stelle anpassen, an der er erstellt wird. Öffne deine chronon_engine.py -Datei und ändere die Initialisierung ( __init__ -Methode) wie folgt ab: ALT: # in der __init__ von ChrononEngine self.cognitive_core = CognitiveCore() NEU: # in der __init__ von ChrononEngine # Hole die Projekt-ID aus der Umgebung (wird in Google Cloud automatisch gesetzt) # oder setze sie manuell für lokale Tests. PROJECT_ID = os.environ.get('GCP_PROJECT', 'DEINE-PROJEKT-ID-HIER') SECRET_ID = 'gemini-api-key' # Der Name, den du in Schritt 1 vergeben hast self.cognitive_core = CognitiveCore(project_id=PROJECT_ID, secret_id=SECRET_ID) Zusammenfassung der Vorteile ✅ Maximale Sicherheit : Dein API-Schlüssel steht nie wieder im Code oder in einer Konfigurationsdatei. Er verlässt nie die sichere Umgebung von Google Cloud. ✅ Zentrale Verwaltung : Wenn du den Schlüssel ändern musst, tust du das an einem einzigen Ort im Secret Manager. Alle deine Anwendungen, die darauf zugreifen, erhalten automatisch den neuen Schlüssel. ✅ Auditierbarkeit : Google Cloud protokolliert jeden Zugriff auf dein Secret. Du siehst genau, wer oder was wann darauf zugegriffen hat. ✅ Produktionsstandard : Du verwendest jetzt die empfohlene Best-Practice-Methode für die Verwaltung von Zugangsdaten in der Cloud. Deine Anwendung ist damit bereit für den professionellen Einsatz.