Timestamp: 16.10.2025, 11:52:58 MESZ
Speaker: ai

Verstanden. Hier ist Teil 2 des Codes. Dieser Abschnitt enthält die Service- und Infrastruktur-Klassen, einschließlich des CognitiveCore , der nun so angepasst ist, dass er vollständig offline funktioniert und keine Verbindung zur Google API herstellt. # ============================================================================== # 2. SERVICES & INFRASTRUKTUR # ============================================================================== class VectorizationService: """Erzeugt deterministische Hash-Vektoren für den Offline-Betrieb.""" def __init__(self, dimensions=64): self.dimensions = dimensions def vectorize(self, text: str) -> np.ndarray: """Erzeugt einen stabilen, deterministischen Vektor mittels Hashing.""" if not text: return np.zeros(self.dimensions, dtype=np.float32) hash_bytes = hashlib.sha512(text.encode('utf-8')).digest() vector = np.array([ (hash_bytes[i % len(hash_bytes)] / 127.5) - 1.0 for i in range(self.dimensions) ], dtype=np.float32) return self._normalize(vector) def _normalize(self, vector: np.ndarray) -> np.ndarray: """Normalisiert den Vektor auf eine Einheitslänge.""" norm = np.linalg.norm(vector) if norm == 0 or not np.isfinite(norm): return np.zeros_like(vector) return vector / norm def cosine_similarity(self, v1: np.ndarray, v2: np.ndarray) -> float: """Berechnet die Kosinus-Ähnlichkeit zwischen zwei Vektoren.""" try: if (not np.isfinite(v1).all()) or (not np.isfinite(v2).all()) or np.linalg.norm(v1) == 0 or np.linalg.norm(v2) == 0: return 0.0 return np.dot(self._normalize(v1), self._normalize(v2)) except ValueError: logger.error("ValueError bei Kosinus-Ähnlichkeit.") return 0.0 class CognitiveCore: """Schnittstelle zur Google Gemini API (im Offline-Modus deaktiviert).""" def __init__(self, model_name='offline_stub'): self.model_name = model_name self.is_available = False logger.warning("CognitiveCore im Offline-Modus. Alle Generierungsanfragen werden eine Standardantwort zurückgeben.") def generate(self, prompt: str, mode: str, base_system_instruction: str, temp_override: Optional[float] = None): """ Gibt im Offline-Modus eine standardisierte, vordefinierte Antwort zurück, um die Systemlogik ohne echte API-Aufrufe zu testen. """ if not self.is_available: # Erstelle ein Mock-Response-Objekt, das der Struktur der echten API entspricht class MockResponse: def __init__(self, text): self.text = text self.usage_metadata = None # Simuliert fehlende Metadaten offline_text = f"OFFLINE-MODUS: Anfrage '{prompt[:30]}...' im Modus '{mode}' erhalten. Keine Generierung möglich." return MockResponse(offline_text) # Der folgende Code wird in dieser Version nie erreicht, bleibt aber für Kompatibilität erhalten. raise IOError("CognitiveCore wurde im Offline-Modus aufgerufen, obwohl er als verfügbar markiert war.")